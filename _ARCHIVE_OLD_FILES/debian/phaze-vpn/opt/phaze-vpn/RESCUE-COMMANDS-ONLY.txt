# ============================================
# COPY/PASTE THESE COMMANDS (you're already in rescue mode)
# ============================================

# Step 1: Find your disk
lsblk

# Step 2: Mount (use /dev/sda1 or /dev/vda2 from lsblk output)
mkdir -p /mnt/recovery
mount /dev/sda1 /mnt/recovery

# Step 3: Bind directories
mount --bind /dev /mnt/recovery/dev
mount --bind /proc /mnt/recovery/proc
mount --bind /sys /mnt/recovery/sys

# Step 4: Chroot
chroot /mnt/recovery

# Step 5: Fix firewall (all at once)
systemctl stop ufw
systemctl disable ufw
iptables -F
iptables -X
iptables -t nat -F
iptables -t nat -X
iptables -P INPUT ACCEPT
iptables -P FORWARD ACCEPT
iptables -P OUTPUT ACCEPT
iptables -A INPUT -i lo -j ACCEPT
iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
iptables -A INPUT -p tcp --dport 22 -j ACCEPT
iptables -A INPUT -p udp --dport 53 -j ACCEPT
iptables -A INPUT -p tcp --dport 53 -j ACCEPT
iptables -A INPUT -p tcp --dport 443 -j ACCEPT
iptables -A INPUT -p tcp --dport 80 -j ACCEPT
iptables -A INPUT -p udp --dport 1194 -j ACCEPT
iptables -A INPUT -p icmp -j ACCEPT
iptables -P INPUT DROP
iptables -P FORWARD DROP
mkdir -p /etc/iptables
apt-get update -qq
apt-get install -y iptables-persistent -qq
iptables-save > /etc/iptables/rules.v4
systemctl restart sshd
systemctl enable sshd

# Step 6: Exit chroot
exit

# Step 7: Reboot
reboot


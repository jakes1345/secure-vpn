{% extends "base.html" %}

{% block title %}User Management - SecureVPN{% endblock %}

{% block content %}
<h1>ğŸ‘¥ User Management</h1>

<div class="card">
    <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
        <span>Users ({{ users|length }})</span>
        <button class="btn btn-primary" onclick="addUser()">â• Add User</button>
    </div>
    
    <table>
        <thead>
            <tr>
                <th>Username</th>
                <th>Role</th>
                <th>Created</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id="users-table">
            {% for username, user_data in users.items() %}
            <tr data-user="{{ username }}">
                <td>{{ username }}</td>
                <td><span class="badge badge-{{ user_data.role }}">{{ user_data.role }}</span></td>
                <td>{{ user_data.created[:10] if user_data.created else 'N/A' }}</td>
                <td>
                    {% if username != session.username %}
                    <button class="btn btn-danger" style="padding: 0.25rem 0.5rem; font-size: 0.8rem;" onclick="deleteUser('{{ username }}')">ğŸ—‘ï¸ Delete</button>
                    {% else %}
                    <span style="color: #b0b0b0;">(Current user)</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<script>
function addUser() {
    const username = prompt('Enter username:');
    if (!username || !username.trim()) return;
    
    const password = prompt('Enter password:');
    if (!password) return;
    
    const role = prompt('Enter role (admin/moderator/user):', 'user');
    if (!role) return;
    
    // Send to API
    fetch('/api/users', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
            username: username.trim(),
            password: password,
            role: role.toLowerCase()
        })
    })
    .then(res => res.json())
    .then(data => {
        if (data.success) {
            location.reload();
        } else {
            alert('Error: ' + (data.error || 'Failed to create user'));
        }
    });
}

function deleteUser(username) {
    if (!confirm(`Delete user "${username}"? This cannot be undone.`)) return;
    
    fetch(`/api/users/${username}`, {
        method: 'DELETE'
    })
    .then(res => res.json())
    .then(data => {
        if (data.success) {
            location.reload();
        } else {
            alert('Error: ' + (data.error || 'Failed to delete user'));
        }
    });
}
</script>
{% endblock %}

